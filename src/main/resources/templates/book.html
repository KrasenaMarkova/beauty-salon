<!DOCTYPE html>
<html lang="bg" xmlns="http://www.w3.org/1999/xhtml"
      xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>–ó–∞–ø–∞–∑–≤–∞–Ω–µ –Ω–∞ —á–∞—Å - Beauty salon</title>
  <link rel="stylesheet" type="text/css" href="/css/index.css">
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
</head>

<body>

<!-- ======= –ì–æ—Ä–µ–Ω —Ö–µ–¥—ä—Ä ======= -->
<div class="top-header">
  <div class="contact">üìû 0888 123 456</div>
  <div class="address">üìç –≥—Ä. –†—É—Å–µ, –±—É–ª. –ö—Ä–∞—Å–æ—Ç–∞ 19</div>
</div>

<!-- ======= –ù–∞–≤–∏–≥–∞—Ü–∏—è ======= -->
<header class="info">
  <nav>
    <ul>
      <li><a th:href="@{/}">–ù–∞—á–∞–ª–æ</a></li>
      <li><a th:href="@{/about-us}">–ó–∞ –Ω–∞—Å</a></li>
      <li><a th:href="@{/team}">–ï–∫–∏–ø</a></li>
      <li><a th:href="@{/booking}" class="active">–ó–∞–ø–∞–∑–∏ —á–∞—Å</a></li>
      <li><a th:href="@{/login}">–í—Ö–æ–¥</a></li>
    </ul>
  </nav>
</header>

<!-- ======= Hero —Å–µ–∫—Ü–∏—è ======= -->
<section class="hero">
  <div class="hero-text">
    <h1>–ó–∞–ø–∞–∑–µ—Ç–µ —Å–≤–æ—è —á–∞—Å –≤ —Å–∞–ª–æ–Ω "Bellezza"</h1>
    <p>–ò–∑–±–µ—Ä–µ—Ç–µ —É—Å–ª—É–≥–∞, –¥–∞—Ç–∞ –∏ —É–¥–æ–±–µ–Ω —á–∞—Å ‚Äì –Ω–∏–µ —â–µ —Å–µ –ø–æ–≥—Ä–∏–∂–∏–º –∑–∞ –æ—Å—Ç–∞–Ω–∞–ª–æ—Ç–æ.</p>
  </div>
</section>

<!-- ======= –û—Å–Ω–æ–≤–Ω–æ —Å—ä–¥—ä—Ä–∂–∞–Ω–∏–µ ======= -->
<main class="container">
  <div class="reservation" id="reservation">
    <h2>–§–æ—Ä–º–∞ –∑–∞ —Ä–µ–∑–µ—Ä–≤–∞—Ü–∏—è</h2>

    <!--    <form id="booking-form" th:action="@{/booking}" th:method="POST" th:object="${bookingRequest}">-->
    <form id="booking-form" th:action="@{/booking}" th:method="POST"
          th:object="${appointmentRequest}">

      <input type="hidden" th:field="*{date}" id="hiddenDate">
      <input type="hidden" th:field="*{selectedTime}" id="hiddenTime">
      <input type="hidden" th:field="*{serviceId}" id="hiddenServiceId">
      <input type="hidden" th:field="*{userId}" value="a0eebc99-9c0b-4ef8-bb6d-6bb9bd380a11">

      <label for="serviceId">–£—Å–ª—É–≥–∞:</label>
      <select id="serviceId" name="serviceId" required>
        <option value="">–ò–∑–±–µ—Ä–µ—Ç–µ...</option>
        <option th:each="treatment : ${treatments}"
                th:value="${treatment.id}"
                th:text="${treatment.serviceName.displayName + ' (' + treatment.durationMinutes + ' –º–∏–Ω.)'}">
        </option>
      </select>

      <!--      <select id="serviceId" name="serviceId" required th:field="*{country}">-->
      <!--        <option th:each="country : ${T(app.user.model.Country).values()}" th:value="${country}" th:text="${country.getDisplayName()}">abv</option>-->
      <!--      </select>-->

      <label for="bookingDate">–î–∞—Ç–∞:</label>
      <input type="date" id="bookingDate" name="date" required>

      <label>–°–≤–æ–±–æ–¥–Ω–∏ —á–∞—Å–æ–≤–µ:</label>
      <div id="time-slots-container"></div>

      <div th:if="${successMessage}" class="alert alert-success" th:text="${successMessage}"></div>
      <div th:if="${errorMessage}" class="alert alert-danger" th:text="${errorMessage}"></div>

      <button type="submit">–†–µ–∑–µ—Ä–≤–∏—Ä–∞–π</button>
    </form>
  </div>
</main>

<th:block th:insert="~{fragments/footer :: my-footer}"></th:block>

<script>
  $('#bookingDate, #serviceId').on('change', function () {
    var date = $('#bookingDate').val();
    var serviceId = $('#serviceId').val();
    var slotsContainer = $('#time-slots-container');

    $('#hiddenDate').val(date);
    $('#hiddenServiceId').val(serviceId);
    $('#hiddenTime').val('');

    if (date && serviceId) {
      slotsContainer.html('<p>–ó–∞—Ä–µ–∂–¥–∞–Ω–µ –Ω–∞ —á–∞—Å–æ–≤–µ...</p>');

      $.ajax({
        url: '/available-slots',
        type: 'GET',
        data: {date: date, serviceId: serviceId},
        success: function (slots) {
          slotsContainer.empty();
          if (slots.length > 0) {
            slots.forEach(function (slot) {
              var radio = `
                <div class="time-option">
                  <input type="radio" name="selectedTime" value="${slot}" id="slot-${slot}" required>
                  <label for="slot-${slot}">${slot}</label>
                </div>`;
              slotsContainer.append(radio);
            });
          } else {
            slotsContainer.append('<p class="text-danger">–ù—è–º–∞ —Å–≤–æ–±–æ–¥–Ω–∏ —á–∞—Å–æ–≤–µ –∑–∞ —Ç–∞–∑–∏ –¥–∞—Ç–∞.</p>');
          }
        },
        error: function () {
          slotsContainer.empty();
          slotsContainer.append('<p class="text-danger">–ì—Ä–µ—à–∫–∞ –ø—Ä–∏ –∑–∞—Ä–µ–∂–¥–∞–Ω–µ –Ω–∞ —á–∞—Å–æ–≤–µ—Ç–µ.</p>');
        }
      });
    } else {
      slotsContainer.empty();
    }
  });

  $(document).on('change', 'input[name="selectedTime"]', function () {
    $('#hiddenTime').val($(this).val());
  });
</script>

</body>
</html>